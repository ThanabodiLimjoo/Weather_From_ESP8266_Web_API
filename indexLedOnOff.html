<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Ubuntu&display=swap" rel="stylesheet">
    <title>IoT</title>
</head>

<style>
    * {
        font-family: 'Ubuntu', monospace;
    }

    /* Chrome, Safari, Edge, Opera */
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }

    /* Firefox */
    input[type=number] {
        -moz-appearance: textfield;
    }
</style>

<body>

    <!-- navbar -->
    <nav class="navbar navbar-expand navbar-light bg-dark">
        <ul class="nav navbar-nav">
            <li class="nav-item active">
                <div class="text-white px-3 py-2 fw-bolder fs-5">ITD62-331 IoT for ITD</div>
            </li>
        </ul>
    </nav>
    <!--  -->

    <!-- main -->
    <div class="container py-3 mt-3">

        <div class="fs-1 text-center fw-bolder text-body">
            LED on - off
        </div>

        <div class="row">
            <div class="col-sm-6 col-lg-3">
                <label for="ipInput" class="form-label">IP :</label>
                <input type="text" class="form-control" name="" id="ipInput" value="192.168.0.14" onchange="main()">
            </div>
            <div class="col-sm-6 col-lg-3">
                <label for="portInput" class="form-label">Port <b class="text-danger">( Default: 8080 )</b> :</label>
                <input type="text" class="form-control" name="" id="portInput" value="9191" onchange="main()">
            </div>
        </div>
        <div class="container p-3 m-4">
            <div class="row mb-4">
                <div class="col" id="textOnTop">
                    Yes
                </div>
            </div>
            <div class="row">
                <div class="col-lg-2 " id="btnOnOff">
                    <button class="btn btn-primary" onclick="turnOn()">ON</button>
                    <button class="btn btn-danger" onclick="turnOff()">OFF</button>
                </div>
            </div>
        </div>
    </div>
    <!--  -->

</body>

<script>
    $(() => {
        main()
        // $('#btnOnOff').hide()
    })

    main = () => {
        new ajax().callServer()
    }

    turnOn = () => {
        console.log('on');
        new ajax().turnOn()
    }

    turnOff = () => {
        console.log('off');
        new ajax().turnOff()
    }

    class ajax {
        constructor() {
            this.ip = $('#ipInput').val()
            this.port = $('#portInput').val()
        }

        callServer() {
            console.log(`IP Value = ${this.ip}, Port Value = ${this.port}`)
            $.ajax({
                url: `http://${this.ip}:${this.port}`,
                type: 'GET',
                success: (data) => {
                    console.log(data)
                    $('#textOnTop').html(data)
                    showBtn()
                },
                error: () => {
                    // $('#btnOnOff').hide()
                    if (this.ip || this.port) {
                        if (this.port) {
                            $('#textOnTop').html(`IP : <b>${this.ip}:${this.port}</b> is not found`)
                        } else {
                            $('#textOnTop').html(`IP : <b>${this.ip}:8080</b> is not found`)
                        }
                    }
                }


            })
        }

        turnOn() {
            $.ajax({
                url: `http://${this.ip}:${this.port}/ledon`,
                type: 'GET',
                success: function (data) {
                    console.log(data)
                    $('#textOnTop').text('Yes')
                    $('#btnOnOff').hide()
                }
            })
        }
        turnOff() {
            $.ajax({
                url: `http://${this.ip}:${this.port}/ledoff`,
                type: 'GET',
                success: function (data) {
                    console.log(data)
                    $('#textOnTop').text('No')
                    $('#btnOnOff').show()
                }
            })
        }

    }



    showBtn = () => {
        $('#btnOnOff').show()
    }

    turnOn = () => {

    }

    turnOff = () => {

    }

</script>

</html>